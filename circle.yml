machine:
  python:
    version: 3.6.2

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  override:
    - pip install awscli

deployment:
  release:
    tag: /^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(-(0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(\.(0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*)?(\+[0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*)?$/
    commands:
      - ./bin/build
      - ./bin/deploy $(cat VERSION)
  build:
    branch: /.*?/
    commands:
      - ./bin/build
      - ./bin/deploy ${CIRCLE_BRANCH}.review

test:
  override:
    - echo "test"
